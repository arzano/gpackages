<div class="jumbotron">
  <h2 class="site-welcome stick-top">Welcome to the Home of <span class="text-primary"><%= number_with_delimiter PackageRepository.count %></span> Gentoo Packages</h2>

  <form action="<%= search_packages_path %>" method="get">
    <div class="typeahead-container">
      <div class="typeahead-field">
        <span class="typeahead-query">
          <input id="q" name="q" type="search" autocomplete="off" placeholder="<%= t :find_packages %>" aria-label="<%= t :find_packages %>" autofocus>
        </span>
        <span class="typeahead-button">
          <button type="button" onclick="$('#searchHelp').modal('show')" title="Help" aria-label="<%= "Help" %>">
            <span class="fa fa-question" style="font-size: 15px;"></span><span class="sr-only"><%= "Help" %></span>
          </button>
        </span>
        <span class="typeahead-button">
          <button type="submit" title="<%= t :find %>" aria-label="<%= t :find %>">
            <span class="typeahead-search-icon"></span><span class="sr-only"><%= t :find %></span>
          </button>
        </span>
      </div>
    </div>
  </form>
</div>

<% cache("added-#{@new_packages.hash}") do %>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
      <span class="fa fa-fw fa-history"></span>
      <%= link_to t(:added_packages), added_packages_path %>
    </h3>
  </div>
  <div class="table-responsive">
    <table class="table table-striped">
      <%= render partial: 'package', collection: @new_packages, as: 'change' %>
    </table>
  </div>
</div>
<% end %>

<% cache("updated-#{@version_bumps.hash}") do %>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
      <span class="fa fa-fw fa-asterisk"></span>
      <%= link_to t(:updated_packages), updated_packages_path %>
    </h3>
  </div>
  <ul class="list-group">
    <% @version_bumps.each do |change|
         _package = PackageRepository.find_by(:atom, cp_to_atom(change.category, change.package)) %>
      <%= render partial: 'packages/changed_package', object: change, as: 'change', locals: { package: _package, version: _package.version(change.version) } %>
    <% end %>
  </ul>
</div>
<% end %>

<div class="modal fade" id="searchHelp" tabindex="-1" role="dialog" aria-labelledby="searchHelpTitle">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title" id="searchHelpTitle"><span class="fa fa-info" style="font-size: 15px;"></span>&nbsp; Package Search Syntax</h3>
      </div>
      <div class="modal-body">
        The search can be used to find Gentoo packages. You can search in two different ways:
        <ul >
          <li>Keywords</li>
          <li>Field/Value pairs</li>
        </ul>
        <h4 style="margin-top:35px;">Keywords</h4>
        You can use simple keywords to find packages. For instance, if you search for <i>gentoo-sources</i> you will find the package <i>sys-kernel/gentoo-sources</i>.
        When searching for keywords, the
        <ul >
          <li><b>name</b></li>
          <li> and the <b>atom</b>
        </ul>
        fields are searched for the keyword.
        <h4 style="margin-top:35px;">Field/Value pairs</h4>
        If you, however, like to run advanced queries, you can use field/value pairs combined with operators. The possible fields and operators are summarized in the following tables.
        <table class="table">
          <thead>
          <tr>
            <th scope="col">Field</th>
            <th scope="col">Description</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <th scope="row">atom</th>
            <td>The unique identifier of a package <br> <i style="padding-left:2em">e.g. sys-kernel/gentoo-sources</i></td>
          </tr>
          <tr>
            <th scope="row">category</th>
            <td>The category of a package <br> <i style="padding-left:2em">e.g. sys-kernel</i></td>
          </tr>
          <tr>
            <th scope="row">name</th>
            <td>The name of a package <br> <i style="padding-left:2em">e.g. gentoo-sources</i></td>
          </tr>
          <tr>
            <th scope="row">description</th>
            <td>The description of a package <br> <i style="padding-left:2em">e.g. A tiling window manager</i> </td>
          </tr>
          <tr>
            <th scope="row">longdescription</th>
            <td>The full descripiton of a package <br> <i style="padding-left:2em">e.g. xmonad is a tiling window manager for [...]</i></td>
          </tr>
          <tr>
            <th scope="row">homepage</th>
            <td>The homepage of a package <br> <i style="padding-left:2em">e.g. http://xmonad.org</i></td>
          </tr>
          <tr>
            <th scope="row">license</th>
            <td>The license of a package <br> <i style="padding-left:2em">e.g. BSD</i></td>
          </tr>
          <tr>
            <th scope="row">Maintainers</th>
            <td></td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">maintainers.name</th>
            <td>The name of the maintainer <br> <i style="padding-left:2em">e.g. Gentoo Haskell</i></td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">maintainers.description</th>
            <td>The description of the maintainers</td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">maintainers.type</th>
            <td>The type of maintainter <br> <i style="padding-left:2em">e.g. project</i></td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">maintainers.restrict</th>
            <td></td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">maintainers.email</th>
            <td>The email of the maintainer <br> <i style="padding-left:2em">e.g. haskell@gentoo.org</i></td>
          </tr>
          <tr>
            <th scope="row">Useflag</th>
            <td></td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:1em">global</th>
            <td></td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">useflags.global.name</th>
            <td>The name of the global useflag <br> <i style="padding-left:2em">e.g. hscolour</i></td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">useflags.global.description</th>
            <td>The description of the global useflag <br> <i style="padding-left:2em">e.g. Include coloured haskell sources to [...]</i></td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:1em">local</th>
            <td></td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">useflags.local.name</th>
            <td>The name of the local useflag</td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">useflags.local.description</th>
            <td>The description of the local useflag</td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:1em">use_expand</th>
            <td></td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">useflags.use_expand.name</th>
            <td>The name of the local use_expand</td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">useflags.use_expand.description</th>
            <td>The description of the use_expand</td>
          </tr>
          <tr>
            <th scope="row" style="padding-left:2em">useflags.use_expand.use_expand_prefix</th>
            <td>The use_expand prefix <br> <i style="padding-left:2em">e.g. python_targets</i></td>
          </tr>
          <tr>
            <th scope="row">metadata_hash</th>
            <td>The hash of the metadata <br> <i style="padding-left:2em">e.g. 5cd76e098f966b4edcd1848866dd9099</i></td>
          </tr>
          </tbody>
        </table>
        The following operators can be used to combine multiple field/value pairs:
        <table class="table">
          <thead>
          <tr>
            <th scope="col">Operator</th>
            <th scope="col">Description</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <th scope="row"></th>
            <td>The term <b>should</b> appear (default)</td>
          </tr>
          <tr>
            <th scope="row">+</th>
            <td>The term <b>must</b> appear</td>
          </tr>
          <tr>
            <th scope="row">-</th>
            <td>The term <b>must not</b> appear</td>
          </tr>
          <tr>
            <th scope="row">"..."</th>
            <td>Can be used to <b>group</b> phrases <br> <i style="padding-left:2em">e.g. +description:"window manager"</i></td>
          </tr>
          </tbody>
        </table>

        <h4>Examples</h4>

        <ul>
          <li>Find all packages named git: <br><code style="margin-left:2em">+name:git</code></li>
          <li>Find all packages in the category sys-kernel: <br><code style="margin-left:2em">+category:sys-kernel</code></li>
          <li>Find all packages with a BSD license: <br><code style="margin-left:2em">+license:BSD</code></li>
          <li>Find all packages that neither have a BSD license nor a MIT license: <br><code style="margin-left:2em">-license:BSD -license:MIT</code></li>
          <li>Find all packages maintained by the Haskell Team: <br><code style="margin-left:2em">+maintainer.email:haskell@gentoo.org</code></li>
          <li>Find all packages maintained by the Haskell Team but that aren't in the 'dev-haskell' category: <br><code style="margin-left:2em">+maintainer.email:haskell@gentoo.org -category:dev-haskell</code></li>
          <li>Find all packages those description contains 'window manager': <br><code style="margin-left:2em">+description:"window manager"</code></li>
          <li>Find all packages that contain the use_expand 'python_targets': <br><code style="margin-left:2em">+useflags.use_expand.use_expand_prefix:python_targets</code></li>
        </ul>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<%= javascript_include_tag 'index/typeahead.js' %>
